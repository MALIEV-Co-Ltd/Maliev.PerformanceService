# Performance Management Service - Claude Code Context

<!-- AUTOGENERATED SECTION - DO NOT EDIT MANUALLY -->
<!-- This section is automatically updated by .specify/scripts/powershell/update-agent-context.ps1 -->
<!-- Last updated: 2025-12-28 -->

## Project Overview

This is a .NET 10.0 microservice for managing employee performance reviews, goals, performance improvement plans (PIPs), and 360-degree feedback.

## Technical Stack

- **Language**: .NET 10.0 with C# 13
- **Framework**: ASP.NET Core 10.0
- **Database**: PostgreSQL 18 (primary database), Redis 7.x (distributed cache)
- **Messaging**: RabbitMQ via MassTransit
- **ORM**: Entity Framework Core 10.x
- **Testing**: xUnit with Testcontainers (real PostgreSQL, Redis, RabbitMQ containers)
- **Project Type**: Microservice (4 projects: Api, Application, Domain, Infrastructure, Tests)

## Key Technologies

- Entity Framework Core 10.x (ORM)
- MassTransit (messaging abstraction for RabbitMQ)
- Maliev.Aspire.ServiceDefaults (shared observability, health checks, resilience)
- Data Annotations (validation)
- Testcontainers (.NET) for integration testing
- Polly (circuit breakers, retry policies)
- OpenTelemetry (structured logging, metrics, distributed tracing)

## Architecture

- **Clean Architecture**: API → Application → Domain → Infrastructure
- **CQRS Pattern**: Separate command and query handlers
- **Event-Driven**: Publishes integration events via RabbitMQ
- **Circuit Breakers**: Polly for external service resilience
- **Observability**: OpenTelemetry with structured logging, metrics, tracing

## Project Structure

```
Maliev.PerformanceService/
├── Maliev.PerformanceService.Api/          # REST API controllers, DTOs
├── Maliev.PerformanceService.Application/  # CQRS handlers, validators, interfaces
├── Maliev.PerformanceService.Domain/       # Entities, enums, events
├── Maliev.PerformanceService.Infrastructure/ # EF Core, repositories, background services
└── Maliev.PerformanceService.Tests/        # Unit and integration tests
```

## Key Features

1. **Performance Reviews**: Complete lifecycle management (Draft → Self-Assessment → Manager Review → Submit → Acknowledge → Complete)
2. **Goals**: Goal setting with progress tracking, SMART criteria, status transitions
3. **PIPs**: Performance Improvement Plan workflows with check-ins and outcomes
4. **360-Degree Feedback**: Anonymous/attributed feedback from peers, managers, direct reports

## Domain Entities

- **PerformanceReview**: Employee performance evaluations with self and manager assessments
- **Goal**: Employee objectives with progress updates and completion tracking
- **PerformanceImprovementPlan**: Formal improvement plans with check-ins
- **ReviewFeedback**: 360-degree feedback submissions

## Data Protection

- **Encryption at Rest**: PostgreSQL encryption for all performance data
- **Encryption in Transit**: TLS 1.2+ for all HTTP requests
- **Field-Level Encryption**: PII (employee names, IDs) encrypted using .NET Data Protection API
- **Key Management**: Encryption keys in Google Secret Manager, 90-day rotation

## External Dependencies

- **Employee Service**: Employee data, manager-employee relationships
- **Notification Service**: Reminders, alerts
- **Authentication Service**: JWT token validation

## Background Services

- **PerformanceReviewReminderBackgroundService**: Daily at 8 AM (pending self-assessments, manager reviews)
- **PIPCheckInReminderBackgroundService**: Weekly on Monday at 9 AM (PIP check-ins, end date alerts)

## Important Business Rules

1. **Review Period Overlap**: Cannot create overlapping review periods for same employee + cycle
2. **Self-Assessment Required**: Manager cannot submit review until employee completes self-assessment
3. **Data Volume Limits**: 50 reviews, 100 goals, 200 feedback per employee (soft warning at 80%)
4. **PIP Constraints**: Only ONE active PIP per employee, maximum ONE extension
5. **Anonymity Protection**: Suppress anonymous feedback if only 1 provider of that type

## Constitution Compliance

This project follows the MALIEV Microservices Constitution:
- NO AutoMapper (explicit mapping)
- NO FluentValidation (Data Annotations)
- NO FluentAssertions (xUnit Assert)
- Testcontainers for real infrastructure (no in-memory substitutes)
- Flat project structure (no /src or /tests folders)
- Dockerfile in API project folder

<!-- END AUTOGENERATED SECTION -->

## Custom Notes

Add any manual project-specific notes below this line. They will be preserved during updates.
